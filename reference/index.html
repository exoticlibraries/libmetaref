<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmetaref: libmetaref</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libmetaref
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">libmetaref </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Extends struct for reflection and runtime analysis. Allows (string like) annotation for struct fields.</p>
<h1>Why?</h1>
<p>Well I want a situation whereby I can assign the values of struct fields without the need to know what field is declared or not. For example to deserialize a json object into a struct in the traditional manner I will be aware of the JSON object structure and the struct fields so I iterate the JSON object and assign match with the struct fields, this requires me to know both the JSON structure and the struct fields, but with this library there is no need to be aware of either of the two a json library that support libmetaref can just simply take your JSON object, struct and assign where appropriate and possibly set non matching field to NULL.</p>
<p>An example is described below.</p>
<p><em>location.json</em></p>
<div class="fragment"><div class="line">{</div><div class="line">    &quot;longitude&quot;: 123.45,</div><div class="line">    &quot;latitude&quot;: 678.90</div><div class="line">}</div></div><!-- fragment --><p>The Location struct file:</p>
<p><em>location_struct.h</em></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define __STRUCT_FILE__ &quot;location_struct.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="metaref_8h.html">exotic/metaref.h</a>&gt;</span></div><div class="line"></div><div class="line">STRUCT(Location,</div><div class="line">    FIELD(<span class="keywordtype">long</span>, longitude)</div><div class="line">    FIELD(<span class="keywordtype">long</span>, latitude)</div><div class="line">)</div></div><!-- fragment --><p>Assume a JSON library that add support for libmetaref</p>
<p><em>json_to_struct.c</em> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;location_struct.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;exotic/xson.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div><div class="line">    xson_object* json;</div><div class="line">    Location *location = malloc(<span class="keyword">sizeof</span>(Location));</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (xson_obj_from_file(&amp;json, <span class="stringliteral">&quot;location.json&quot;</span>) != XSON_OK || </div><div class="line">        xson_deserialize(json, location) != XSON_OK) {</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    printf(<span class="stringliteral">&quot;Longitude %.3f&quot;</span>, location-&gt;longitude);</div><div class="line">    printf(<span class="stringliteral">&quot;Latitude %.3f&quot;</span>, location-&gt;latitude);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>In the example above the json library handles the struct field assignment, the json values validation. The example above is a pseudocode it not expected to compile.</p>
<h1>Note</h1>
<p>Must initialize the struct with calloc to enable all the field values are NULL</p>
<h2>Limitations and Safety</h2>
<p>Compile time check still happens</p>
<p>It cannot auto detect type of field, esp struct</p>
<h1>Best practice</h1>
<p>Functions expecting struct created with metaref should have the <code>_metaref</code> prefix. E.g.</p>
<p>A function that accept struct not defined with metaref</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> struct_to_string(<span class="keywordtype">void</span>*);</div></div><!-- fragment --><p>A function that accept struct defined with metaref</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> struct_to_string_metaref(<span class="keywordtype">void</span>*);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
